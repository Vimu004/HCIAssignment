{% extends "base.html" %}
{% block content %}
<div class="flex flex-col md:flex-row h-screen overflow-hidden">
  <!-- Sidebar Panel -->
  <aside class="w-full md:w-1/4 bg-white dark:bg-gray-900 p-6 space-y-6 overflow-y-auto shadow-md z-10">
    <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Studio Controls</h2>

    <div class="space-y-4">
      <!-- Color Pickers -->
      <label class="block text-sm text-gray-600 dark:text-gray-300">Wall Color</label>
      <input type="color" id="wallColor" value="#dddddd" class="w-full h-10 rounded border" />

      <label class="block text-sm text-gray-600 dark:text-gray-300">Floor Color</label>
      <input type="color" id="floorColor" value="#eeeeee" class="w-full h-10 rounded border" />

      <label class="block text-sm text-gray-600 dark:text-gray-300">Ceiling Color</label>
      <input type="color" id="ceilingColor" value="#ffffff" class="w-full h-10 rounded border" />

      <!-- Floor Material -->
      <label class="block text-sm text-gray-600 dark:text-gray-300">Floor Material</label>
      <select id="floorMaterial" class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded text-gray-900 dark:text-white">
        <option value="wood">Wood</option>
        <option value="tile">Tile</option>
        <option value="marble">Marble</option>
      </select>

      <!-- Room Dimensions -->
      <label class="block text-sm text-gray-600 dark:text-gray-300">Room Width: <span id="roomWidthValue">10</span> m</label>
      <input type="range" id="roomWidth" min="1" max="30" value="10" class="w-full" />

      <label class="block text-sm text-gray-600 dark:text-gray-300">Room Length: <span id="roomLengthValue">10</span> m</label>
      <input type="range" id="roomLength" min="1" max="30" value="10" class="w-full" />

      <label class="block text-sm text-gray-600 dark:text-gray-300">Lighting Intensity: <span id="lightIntensityValue">1.0</span></label>
      <input type="range" id="lightIntensity" min="0" max="10" step="0.1" value="1" class="w-full" />

      <!-- Snap Toggle -->
      <button id="snapToggleBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded mt-2 transition">
        ğŸ”³ Toggle Snap to Grid
      </button>

      <!-- Reset Room -->
      <button id="resetRoomBtn" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded mt-4">
        ğŸ” Reset Room
      </button>
    </div>

    <!-- Catalog Button -->
    <div class="mt-6">
      <h3 class="text-md font-semibold text-gray-800 dark:text-gray-200 mb-2">Add Furniture</h3>
      <a href="{{ url_for('furniture_bp.catalog_selector') }}">
        <button class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded shadow">
          ğŸ›‹ Add Furniture
        </button>
      </a>
    </div>
  </aside>

  <!-- Main Viewer -->
  <main class="flex-1 min-w-0 relative h-screen overflow-hidden bg-gray-200 dark:bg-gray-800">
    <!-- Canvas -->
    <canvas id="studioCanvas" class="w-full h-full block"></canvas>

    <!-- Top-Right Controls -->
    <div class="absolute top-4 right-4 z-10 flex flex-col gap-3">
      <a href="{{ url_for('checkout_bp.checkout') }}">
        <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow">
          Proceed to Checkout
        </button>
      </a>
      <button id="saveDesignBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow">
        ğŸ’¾ Save Design
      </button>
      <button id="deleteModelBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded shadow">
        ğŸ—‘ Delete Selected
      </button>
      <button id="exportScreenshotBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded shadow">
        ğŸ“¸ Export Screenshot
      </button>
    </div>

    <!-- Bottom Center Model Controls -->
    <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 z-10 flex items-center gap-4">
      <!-- Rotate Left -->
      <button id="rotateLeftBtn" disabled class="bg-white dark:bg-gray-700 border rounded-full p-2 shadow hover:bg-gray-100 dark:hover:bg-gray-600 transition">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" class="h-6 w-6 text-gray-800 dark:text-white" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>

      <!-- Rotate Right -->
      <button id="rotateRightBtn" disabled class="bg-white dark:bg-gray-700 border rounded-full p-2 shadow hover:bg-gray-100 dark:hover:bg-gray-600 transition">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" class="h-6 w-6 text-gray-800 dark:text-white" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>

    <!-- Optional selection feedback -->
    <div class="absolute bottom-4 left-4 z-10 text-white text-sm px-3 py-1 rounded bg-gray-800 bg-opacity-70" id="selectedModelInfo">
      No model selected
    </div>
  </main>
</div>

<!-- Viewer Script -->
<script type="module" src="{{ url_for('static', filename='js/assets/main-BPdb1Acm.js') }}"></script>

<!-- Slider Label Sync -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const bind = (sliderId, labelId, transform = v => v) => {
      const slider = document.getElementById(sliderId);
      const label = document.getElementById(labelId);
      const update = () => label.textContent = transform(slider.value);
      slider.addEventListener("input", update);
      update();
    };

    bind("roomWidth", "roomWidthValue");
    bind("roomLength", "roomLengthValue");
    bind("lightIntensity", "lightIntensityValue", v => parseFloat(v).toFixed(1));
  });
</script>
{% endblock %}
